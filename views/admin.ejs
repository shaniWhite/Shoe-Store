<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="/admin.css">

    <script>
        function filterActivities() {
            const filter = document.getElementById('usernameFilter').value.toLowerCase();
            const rows = document.getElementsByClassName('activityRow');
            for (let row of rows) {
                const username = row.getElementsByTagName('td')[1].innerText.toLowerCase();
                if (username.startsWith(filter)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            }
        }
    </script>
</head>
<body>
        <div style="min-height:100vh; background:#faf8f2; display:flex; flex-direction:column; align-items:center; justify-content:flex-start;">
            <div style="width:100%; display:flex; align-items:center; justify-content:center; margin-bottom:24px; margin-top:32px;">
                <div style="font-family:'Montserrat', 'Playfair Display', Arial, sans-serif; font-size:2.8em; font-weight:800; letter-spacing:0.12em; color:#222; text-transform:uppercase; text-align:center; position:relative;">
                    StepUp
                    <span style="display:block; width:48px; height:4px; background:#bfa76f; margin:16px auto 0 auto; border-radius:2px;"></span>
                    <div style="font-size:1.1em; font-weight:700; letter-spacing:0.08em; color:#bfa76f; margin-top:10px;">Admin Panel</div>
                </div>
            </div>
            <div style="width:100%; text-align:center; font-size:1.1em; color:#222; margin-bottom:18px;">Here you can manage users and view activity logs.</div>
            <a href="/users/store" style="color:#bfa76f; font-weight:700; text-decoration:none; border:2px solid #bfa76f; background:#fff; border-radius:8px; padding:8px 24px; margin-bottom:24px; display:inline-block;">Return to Store</a>
            <div style="width:100%; max-width:1000px; margin:0 auto; background:#fff; border-radius:18px; box-shadow:0 2px 16px rgba(191,167,111,0.08); padding:32px 36px;">
                <h2 style="font-family:'Montserrat', Arial, sans-serif; color:#bfa76f; font-size:1.5em; font-weight:700; margin-bottom:18px;">User Activity Log</h2>
                <input type="text" id="usernameFilter" onkeyup="filterActivities()" placeholder="Filter by username..." style="width:100%; max-width:400px; padding:10px 16px; border:1px solid #bfa76f; border-radius:8px; font-size:1em; background:#faf8f2; color:#222; margin-bottom:12px;">
                <button onclick="clearLogs()" style="margin-left:15px; background:#bfa76f; color:#fff; padding:12px 20px; border:none; border-radius:8px; font-weight:700; font-size:1em; cursor:pointer;">Clear Logs</button>
                <table style="width:100%; max-width:1000px; border-collapse:collapse; margin-top:30px; margin-bottom:30px; background:#fff; border-radius:8px; box-shadow:0 2px 10px rgba(191,167,111,0.05); overflow:hidden;">
                    <thead>
                        <tr style="background:#faf8f2; color:#bfa76f; font-weight:700;">
                            <th style="padding:15px 30px; text-align:left;">Date/Time</th>
                            <th style="padding:15px 30px; text-align:left;">Username</th>
                            <th style="padding:15px 30px; text-align:left;">Activity</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% activityLog.forEach(function(activity) { %>
                        <tr class="activityRow">
                            <td style="padding:15px 30px;"> <%= activity.datetime %> </td>
                            <td style="padding:15px 30px;"> <%= activity.username %> </td>
                            <td style="padding:15px 30px;"> <%= activity.type %> </td>
                        </tr>
                        <% }); %>
                    </tbody>
                </table>
                <script>
                    function clearLogs() {
                        fetch('/users/admin/clear-logs', {
                            method: 'POST'
                        })
                        .then(response => {
                            if (response.ok) {
                                alert('Logs cleared!');
                                location.reload();
                            } else {
                                alert('Failed to clear logs.');
                            }
                        });
                    }
                </script>
                <h2 style="font-family:'Montserrat', Arial, sans-serif; color:#bfa76f; font-size:1.5em; font-weight:700; margin-bottom:18px;">Manage Products</h2>
                <form action="/users/admin/add-product" method="POST" style="display:flex; flex-direction:column; gap:12px; max-width:500px; margin:0 auto;">
                    <input type="text" name="title" placeholder="Product Title" required style="padding:10px 16px; border:1px solid #bfa76f; border-radius:8px; font-size:1em; background:#faf8f2; color:#222;">
                    <input type="text" name="description" placeholder="Product Description" required style="padding:10px 16px; border:1px solid #bfa76f; border-radius:8px; font-size:1em; background:#faf8f2; color:#222;">
                    <input type="text" name="image" placeholder="Image Filename (e.g., /images/blackshoe.jpg)" required style="padding:10px 16px; border:1px solid #bfa76f; border-radius:8px; font-size:1em; background:#faf8f2; color:#222;">
                    <input type="number" name="price" placeholder="Product Price (in $)" required style="padding:10px 16px; border:1px solid #bfa76f; border-radius:8px; font-size:1em; background:#faf8f2; color:#222;">
                    <button type="submit" style="width:100%; padding:12px 0; background:#fff; color:#bfa76f; border:2px solid #bfa76f; border-radius:8px; font-size:1.15em; font-family:'Montserrat', Arial, sans-serif; font-weight:700; letter-spacing:0.08em; cursor:pointer; margin-top:8px;">Add Product</button>
                </form>
            </div>
        </div>
</form>

<h2>Existing Products</h2>
<ul>
    <% products.forEach(function(product) { %>
    <li>
        <strong><%= product.title %></strong> - <%= product.description %><br>
        <!-- Construct the URL based on the image path -->
        <a href="<%= product.image %>" target="_blank"><%= product.image %></a>
        <form action="/users/admin/delete-product" method="POST" style="display:inline;">
            <input type="hidden" name="title" value="<%= product.title %>">
            <button type="submit">Remove</button>
        </form>
    </li>
    <% }); %>
</ul>


</body>
</html>
